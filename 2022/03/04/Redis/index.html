<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/yt32.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/yt16.jpg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Muse',
    version: '7.7.1',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="Redis什么是Redisredis是一种nosql,即非关系型数据库,也是缓存数据库,即将数据存储在缓存中,并且是以键值对的方式存储的,缓存的读取速度快,能够大大的提高运行效率,但是保存时间有限。  NoSQL 可以理解为Not only SQL 不只有结构化查询语言    SQL的特点： - 结构化(Structured) - 关联性(Relational) - SQL 查询 - ACID 原">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis">
<meta property="og:url" content="http://yoursite.com/2022/03/04/Redis/index.html">
<meta property="og:site_name" content="ZWZ的博客嘻嘻">
<meta property="og:description" content="Redis什么是Redisredis是一种nosql,即非关系型数据库,也是缓存数据库,即将数据存储在缓存中,并且是以键值对的方式存储的,缓存的读取速度快,能够大大的提高运行效率,但是保存时间有限。  NoSQL 可以理解为Not only SQL 不只有结构化查询语言    SQL的特点： - 结构化(Structured) - 关联性(Relational) - SQL 查询 - ACID 原">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/06/bDDOMV.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/06/bDr1QP.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/06/bDywrV.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/06/bD6edU.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/06/bD6OfJ.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/06/bDhiAP.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/03/06/bDhuBn.png">
<meta property="og:image" content="https://www.helloimg.com/images/2022/04/05/Rms86u.png">
<meta property="og:image" content="https://www.helloimg.com/images/2022/04/05/Rmto55.png">
<meta property="og:image" content="https://www.helloimg.com/images/2022/04/05/RmtPdm.png">
<meta property="og:image" content="https://www.helloimg.com/images/2022/04/05/RmtFm0.png">
<meta property="og:image" content="https://www.helloimg.com/images/2022/04/05/Rm4ZPt.png">
<meta property="og:image" content="https://www.helloimg.com/images/2022/04/05/RmAJJo.png">
<meta property="og:image" content="https://www.helloimg.com/images/2022/04/05/RmAxub.png">
<meta property="og:image" content="https://www.helloimg.com/images/2022/04/05/RmvOhS.png">
<meta property="og:image" content="https://www.helloimg.com/images/2022/04/05/RmvvWQ.png">
<meta property="og:image" content="https://www.helloimg.com/images/2022/04/05/RmvQHv.png">
<meta property="og:image" content="https://www.helloimg.com/images/2022/04/05/Rmv7CY.png">
<meta property="og:image" content="https://www.helloimg.com/images/2022/04/05/RmvpDE.png">
<meta property="og:image" content="https://www.helloimg.com/images/2022/04/05/Rmvran.png">
<meta property="og:image" content="https://www.helloimg.com/images/2022/04/05/RmvhGA.png">
<meta property="og:image" content="https://www.helloimg.com/images/2022/04/05/Rmz90E.png">
<meta property="og:image" content="https://www.helloimg.com/images/2022/04/05/RmDA2D.png">
<meta property="og:image" content="https://www.helloimg.com/images/2022/04/05/RmDLKS.png">
<meta property="og:image" content="https://www.helloimg.com/images/2022/04/05/RmIr1X.png">
<meta property="og:image" content="https://www.helloimg.com/images/2022/04/05/Rm6XuT.png">
<meta property="og:image" content="https://www.helloimg.com/images/2022/04/05/Rm6j8D.png">
<meta property="article:published_time" content="2022-03-04T12:08:32.845Z">
<meta property="article:modified_time" content="2022-04-06T15:40:46.052Z">
<meta property="article:author" content="ZWZ">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2022/03/06/bDDOMV.png">

<link rel="canonical" href="http://yoursite.com/2022/03/04/Redis/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>Redis | ZWZ的博客嘻嘻</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ZWZ的博客嘻嘻</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2022/03/04/Redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZWZ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZWZ的博客嘻嘻">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Redis
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-03-04 20:08:32" itemprop="dateCreated datePublished" datetime="2022-03-04T20:08:32+08:00">2022-03-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-06 23:40:46" itemprop="dateModified" datetime="2022-04-06T23:40:46+08:00">2022-04-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="什么是Redis"><a href="#什么是Redis" class="headerlink" title="什么是Redis"></a>什么是Redis</h2><p><strong>redis是一种nosql,即非关系型数据库,也是缓存数据库</strong>,即将数据存储在缓存中,<strong>并且是以键值对的方式存储的</strong>,缓存的读取速度快,能够大大的提高运行效率,但是保存时间有限。</p>
<blockquote>
<p>NoSQL 可以理解为Not only SQL 不只有结构化查询语言</p>
</blockquote>
<p><img src="https://s1.ax1x.com/2022/03/06/bDDOMV.png" alt=""></p>
<p><img src="https://s1.ax1x.com/2022/03/06/bDr1QP.png" alt=""></p>
<p>SQL的特点：</p>
<pre><code>- 结构化(Structured)
- 关联性(Relational)
- SQL 查询
- ACID 原子性（atomicity，或称不可分割性）、一致性（consistency）、隔离性（isolation，又称独立性）、持久性（durability）。
- 存储在磁盘</code></pre><p>NoSQL的特点：</p>
<ul>
<li>非结构化</li>
<li>无关联性</li>
<li>非SQL</li>
<li>BASE (基本一致 ， 无事务)</li>
<li>存储在内存</li>
</ul>
<p>Redis的特征：</p>
<pre><code>- 键值（key-value）型，value支持多种不同数据结构，功能丰富
- 单线程，每个命令具备原子性
- 延迟，速度快（基于内存、IO多路复用、良好的编码）。</code></pre><ul>
<li>支持数据持久化</li>
<li>支持主从集群、分片集群</li>
<li>支持多语言客户端</li>
</ul>
<h2 id="Redis数据结构介绍"><a href="#Redis数据结构介绍" class="headerlink" title="Redis数据结构介绍"></a>Redis数据结构介绍</h2><p>Redis是一个key-value的数据库，key一般是String类型，不过value的类型多种多样：</p>
<ul>
<li>String ：hello</li>
<li>Hash ：{ name:”zwz” , age:20 }</li>
<li>List : [A-&gt;B-&gt;C]</li>
<li>Set : {A,B,C}</li>
<li>SortedSet : {A:1, B:2 , C:3}</li>
<li>GEO : { A:(120.3,30.5) }</li>
<li>BitMap : 0110110101110101011</li>
<li>HyperLog : 0110110101110101011</li>
</ul>
<h2 id="Redis-通用命令"><a href="#Redis-通用命令" class="headerlink" title="Redis 通用命令"></a>Redis 通用命令</h2><p>通用指令是部分数据类型的，都可以使用的指令，常见的有：</p>
<ul>
<li><p>KEYS：查看符合模板的所有key</p>
</li>
<li><p>DEL：删除一个指定的key</p>
</li>
<li><p>EXISTS：判断key是否存在</p>
</li>
<li><p>EXPIRE：给一个key设置有效期，有效期到期时该key会被自动删除</p>
</li>
<li><p>TTL：查看一个KEY的剩余有效期</p>
</li>
</ul>
<p>通过  help [command] </p>
<p>可以查看一个命令的具体用法，例如：</p>
<p><img src="https://s1.ax1x.com/2022/03/06/bDywrV.png" alt=""></p>
<h3 id="String-类型"><a href="#String-类型" class="headerlink" title="String 类型"></a>String 类型</h3><p>String类型，也就是字符串类型，是Redis中最简单的存储类型。</p>
<p>其value是字符串，不过根据字符串的格式不同，又可以分为3类：</p>
<ul>
<li><p>string：普通字符串</p>
</li>
<li><p>int：整数类型，可以做自增、自减操作</p>
</li>
<li><p>float：浮点类型，可以做自增、自减操作</p>
</li>
</ul>
<p>不管是哪种格式，底层都是字节数组形式存储，只不过是编码方式不同。字符串类型的最大空间不能超过</p>
<p>512m</p>
<p><strong>String的常见命令有：</strong></p>
<ul>
<li><p>SET：添加或者修改已经存在的一个String类型的键值对</p>
</li>
<li><p>GET：根据key获取String类型的value</p>
</li>
<li><p>MSET：批量添加多个String类型的键值对</p>
</li>
<li><p>MGET：根据多个key获取多个String类型的value</p>
</li>
<li><p>INCR：让一个整型的key自增1</p>
</li>
<li><p>INCRBY:让一个整型的key自增并指定步长，例如：incrby num 2 让num值自增2</p>
</li>
<li><p>INCRBYFLOAT：让一个浮点类型的数字自增并指定步长</p>
</li>
<li><p>SETNX：添加一个String类型的键值对，前提是这个key不存在，否则不执行</p>
</li>
<li><p>SETEX：添加一个String类型的键值对，并且指定有效期</p>
</li>
</ul>
<p><strong>Redis的key允许有多个单词形成层级结构，多个单词之间用’:’隔开，格式如下：</strong></p>
<p>这个格式并非固定，也可以根据自己的需求来删除或添加词条。</p>
<p>例如我们的项目名称叫 heima，有user和product两种不同类型的数据，我们可以这样定义key：</p>
<ul>
<li><p>user相关的 key：heima:user:1</p>
</li>
<li><p>product相关的 key：heima:product:1</p>
</li>
</ul>
<p>在redis里显示就会变成这样</p>
<p><img src="https://s1.ax1x.com/2022/03/06/bD6edU.png" alt=""></p>
<h3 id="Hash类型"><a href="#Hash类型" class="headerlink" title="Hash类型"></a>Hash类型</h3><p>Hash类型，也叫散列，其value是一个无序字典，类似于Java中的HashMap结构。</p>
<p>String结构是将对象序列化为JSON字符串后存储，当需要修改对象某个字段时很不方便：</p>
<table>
<thead>
<tr>
<th align="center">Key</th>
<th align="center">Value</th>
</tr>
</thead>
<tbody><tr>
<td align="center">heima:user:1</td>
<td align="center">{name:”Jack”,age:21}</td>
</tr>
<tr>
<td align="center">heima:user:2</td>
<td align="center">{name:”Rose”,age:18}</td>
</tr>
</tbody></table>
<p>Hash结构可以将对象中的每个字段独立存储，可以针对单个字段做CRUD：</p>
<p><img src="https://s1.ax1x.com/2022/03/06/bD6OfJ.png" alt=""></p>
<p><strong>Hash的常见命令有：</strong></p>
<ul>
<li><p>HSET key field value：添加或者修改hash类型key的field的值</p>
</li>
<li><p>HGET key field：获取一个hash类型key的field的值</p>
</li>
<li><p>HMSET：批量添加多个hash类型key的field的值</p>
</li>
<li><p>HMGET：批量获取多个hash类型key的field的值</p>
</li>
<li><p>HGETALL：获取一个hash类型的key中的所有的field和value</p>
</li>
<li><p>HKEYS：获取一个hash类型的key中的所有的field</p>
</li>
<li><p>HVALS：获取一个hash类型的key中的所有的value</p>
</li>
<li><p>HINCRBY:让一个hash类型key的字段值自增并指定步长</p>
</li>
<li><p>HSETNX：添加一个hash类型的key的field值，前提是这个field不存在，否则不执行</p>
</li>
</ul>
<h3 id="List类型"><a href="#List类型" class="headerlink" title="List类型"></a>List类型</h3><p>Redis中的List类型与Java中的LinkedList类似，可以看做是一个双向链表结构。既可以支持正向检索和也可以支持反向检索。</p>
<p>特征也与LinkedList类似：</p>
<ul>
<li><p>有序</p>
</li>
<li><p>元素可以重复</p>
</li>
<li><p>插入和删除快</p>
</li>
<li><p>查询速度一般</p>
</li>
</ul>
<p>常用来存储一个有序数据，例如：朋友圈点赞列表，评论列表等。</p>
<p><strong>List的常见命令有：</strong></p>
<ul>
<li><p>LPUSH key  element … ：向列表左侧插入一个或多个元素</p>
</li>
<li><p>LPOP key：移除并返回列表左侧的第一个元素，没有则返回nil</p>
</li>
<li><p>RPUSH key  element … ：向列表右侧插入一个或多个元素</p>
</li>
<li><p>RPOP key：移除并返回列表右侧的第一个元素</p>
</li>
<li><p>LRANGE key star end：返回一段角标范围内的所有元素</p>
</li>
<li><p>BLPOP和BRPOP：与LPOP和RPOP类似，只不过在没有元素时等待指定时间，而不是直接返回nil</p>
</li>
</ul>
<p><img src="https://s1.ax1x.com/2022/03/06/bDhiAP.png" alt=""></p>
<p><img src="https://s1.ax1x.com/2022/03/06/bDhuBn.png" alt=""></p>
<h3 id="Set类型"><a href="#Set类型" class="headerlink" title="Set类型"></a>Set类型</h3><p>Redis的Set结构与Java中的HashSet类似，可以看做是一个value为null的HashMap。因为也是一个hash表，因此具备与HashSet类似的特征：</p>
<ul>
<li><p>无序</p>
</li>
<li><p>元素不可重复</p>
</li>
<li><p>查找快</p>
</li>
</ul>
<p>支持交集、并集、差集等功能</p>
<p><strong>Set的常见命令有：</strong></p>
<ul>
<li><p>SADD key member … ：向set中添加一个或多个元素</p>
</li>
<li><p>SREM key member … : 移除set中的指定元素</p>
</li>
<li><p>SCARD key： 返回set中元素的个数</p>
</li>
<li><p>SISMEMBER key member：判断一个元素是否存在于set中</p>
</li>
<li><p>SMEMBERS：获取set中的所有元素</p>
</li>
<li><p>SINTER key1 key2 … ：求key1与key2的交集</p>
</li>
<li><p>SDIFF key1 key2 … ：求key1与key2的差集</p>
</li>
<li><p>SUNION key1 key2 ..：求key1和key2的并集</p>
</li>
</ul>
<h3 id="SortedSet类型"><a href="#SortedSet类型" class="headerlink" title="SortedSet类型"></a>SortedSet类型</h3><p>Redis的SortedSet是一个可排序的set集合，与Java中的TreeSet有些类似，但底层数据结构却差别很大。SortedSet中的每一个元素都带有一个score属性，可以基于score属性对元素排序，底层的实现是一个跳表（SkipList）加 hash表。</p>
<p>SortedSet具备下列特性：</p>
<ul>
<li><p>可排序</p>
</li>
<li><p>元素不重复</p>
</li>
<li><p>查询速度快</p>
</li>
</ul>
<p>因为SortedSet的可排序特性，经常被用来实现排行榜这样的功能。</p>
<p><strong>SortedSet的常见命令有：</strong></p>
<ul>
<li><p>ZADD key score member：添加一个或多个元素到sorted set ，如果已经存在则更新其score值</p>
</li>
<li><p>ZREM key member：删除sorted set中的一个指定元素</p>
</li>
<li><p>ZSCORE key member : 获取sorted set中的指定元素的score值</p>
</li>
<li><p>ZRANK key member：获取sorted set 中的指定元素的排名</p>
</li>
<li><p>ZCARD key：获取sorted set中的元素个数</p>
</li>
<li><p>ZCOUNT key min max：统计score值在给定范围内的所有元素的个数</p>
</li>
<li><p>ZINCRBY key increment member：让sorted set中的指定元素自增，步长为指定的increment值</p>
</li>
<li><p>ZRANGE key min max：按照score排序后，获取指定排名范围内的元素</p>
</li>
<li><p>ZRANGEBYSCORE key min max：按照score排序后，获取指定score范围内的元素</p>
</li>
<li><p>ZDIFF、ZINTER、ZUNION：求差集、交集、并集</p>
</li>
</ul>
<p>注意：所有的排名默认都是升序，如果要降序则在命令的Z后面添加REV即可</p>
<blockquote>
<p>例如  ZREVRANGE key min max：按照score倒序后，获取指定排名范围内的元素</p>
</blockquote>
<h2 id="Redis-的java客户端"><a href="#Redis-的java客户端" class="headerlink" title="Redis 的java客户端"></a>Redis 的java客户端</h2><h3 id="SpringDataRedis"><a href="#SpringDataRedis" class="headerlink" title="SpringDataRedis"></a>SpringDataRedis</h3><p>SpringData是Spring中数据操作的模块，包含对各种数据库的集成，其中对Redis的集成模块就叫做SpringDataRedis，官网地址：<a href="https://spring.io/projects/spring-data-redis" target="_blank" rel="noopener">https://</a><a href="https://spring.io/projects/spring-data-redis" target="_blank" rel="noopener">spring.io</a><a href="https://spring.io/projects/spring-data-redis" target="_blank" rel="noopener">/projects/spring-data-</a><a href="https://spring.io/projects/spring-data-redis" target="_blank" rel="noopener">redis</a></p>
<ul>
<li><p>提供了对不同Redis客户端的整合（Lettuce和Jedis）</p>
</li>
<li><p>提供了RedisTemplate统一API来操作Redis</p>
</li>
<li><p>支持Redis的发布订阅模型</p>
</li>
<li><p>支持Redis哨兵和Redis集群</p>
</li>
<li><p>支持基于Lettuce的响应式编程</p>
</li>
<li><p>支持基于JDK、JSON、字符串、Spring对象的数据序列化及反序列化</p>
</li>
<li><p>支持基于Redis的JDKCollection实现</p>
</li>
</ul>
<h4 id="SpringDataRedis-快速入门"><a href="#SpringDataRedis-快速入门" class="headerlink" title="SpringDataRedis 快速入门"></a>SpringDataRedis 快速入门</h4><p>SpringDataRedis中提供了RedisTemplate工具类，其中封装了各种对Redis的操作。并且将不同数据类型的操作API封装到了不同的类型中：</p>
<table>
<thead>
<tr>
<th align="center">API</th>
<th align="center">返回值类型</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>redisTemplate</strong>.opsForValue()</td>
<td align="center"><strong>ValueOperations</strong></td>
<td align="center">操作<strong>String</strong>类型数据</td>
</tr>
<tr>
<td align="center"><strong>redisTemplate</strong>.opsForHash()</td>
<td align="center"><strong>HashOperations</strong></td>
<td align="center">操作 <strong>Hash</strong>类型数据</td>
</tr>
<tr>
<td align="center"><strong>redisTemplate</strong>.opsForList()</td>
<td align="center"><strong>ListOperations</strong></td>
<td align="center">操作<strong>List</strong>类型数据</td>
</tr>
<tr>
<td align="center"><strong>redisTemplate</strong>.opsForSet()</td>
<td align="center"><strong>SetOperations</strong></td>
<td align="center">操作<strong>Set</strong>类型数据</td>
</tr>
<tr>
<td align="center"><strong>redisTemplate</strong>.opsForZSet()</td>
<td align="center"><strong>ZSetOperations</strong></td>
<td align="center">操作<strong>SortedSet</strong>类型数据</td>
</tr>
<tr>
<td align="center"><strong>redisTemplate</strong></td>
<td align="center"></td>
<td align="center"><strong>通用的命令</strong></td>
</tr>
</tbody></table>
<p>导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Redis依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--连接池依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>yaml文件：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">        <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.138</span><span class="number">.128</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123321</span></span><br><span class="line">        <span class="attr">lettuce:</span></span><br><span class="line">          <span class="attr">pool:</span></span><br><span class="line">            <span class="attr">max-active:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">max-idle:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">min-idle:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">time-between-eviction-runs:</span> <span class="string">10s</span></span><br></pre></td></tr></table></figure>



<p>注入并测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    redisTemplate.opsForValue().set(<span class="string">"name:"</span>,<span class="string">"zwz"</span>);		<span class="comment">//存入String类型数据</span></span><br><span class="line">	String name = redisTemplate.get(<span class="string">"name"</span>);</span><br><span class="line">    System.out.println(<span class="string">"name = "</span> + name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Redis可以将任意Object类型的数据存入内存中，但是写入之前会把Object序列化为字节码。默认采用JDK的方法，但是得到的结果不符合预期</p>
<p><a href="https://www.helloimg.com/image/Rms86u" target="_blank" rel="noopener"><img src="https://www.helloimg.com/images/2022/04/05/Rms86u.png" alt="Rms86u.png"></a></p>
<ul>
<li>阅读性差</li>
<li>占用内存大</li>
</ul>
<h5 id="Redis序列化"><a href="#Redis序列化" class="headerlink" title="Redis序列化"></a>Redis序列化</h5><p>解决以上的问题有两种方法</p>
<ol>
<li><p>自定义RedisTemplate的序列化方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> RedisTemplate&lt;String,Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> <span class="keyword">throws</span> UnkonwnHostException</span>&#123;</span><br><span class="line">    <span class="comment">//创建Template</span></span><br><span class="line">    RedisTemplate&lt;String,Object&gt; redisTemplate = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">    <span class="comment">//设置连接工厂</span></span><br><span class="line">    redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">    <span class="comment">//设置序列化工具</span></span><br><span class="line">    GenericJackson2JsonRedisSerializer jsonRedisSerializer = <span class="keyword">new</span>  GenericJackson2JsonRedisSerializer();</span><br><span class="line">    <span class="comment">//key 和 hashKey采用string序列化</span></span><br><span class="line">    redisTemplate.setKeySerializer(RedisSerializer.string());</span><br><span class="line">    redisTemplate.setHashKeySerializer(RedisSerializer.string());</span><br><span class="line">    <span class="comment">//value和HashValue采用Json序列化</span></span><br><span class="line">    redisTemplate.setValueSerializer(jsonRedisSerializer);</span><br><span class="line">    redisTemplate.setHashValueSerializer(jsonRedisSerializer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通过@Bean的注入覆盖原来的序列化方法 </p>
</blockquote>
</li>
</ol>
<p>但是这种方法依旧会出现问题</p>
<p><strong>为了在反序列化时知道对象的类型，JSON序列化器会将类的class类型写入json结果中，存入Redis，会带来额外的内存开销。</strong></p>
<ol start="2">
<li><strong>StringRedisTemplate</strong></li>
</ol>
<blockquote>
<p>为了节省内存空间，我们并不会使用JSON序列化器来处理value，而是统一使用String序列化器，要求只能存储String类型的key和value。当需要存储Java对象时，手动完成对象的序列化和反序列化。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowried</span></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">//json的工具</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> ObejctMapper  mapper =  <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testStringRedisTemplate</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException</span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User(<span class="string">"zwz"</span>,<span class="number">18</span>);</span><br><span class="line">    <span class="comment">// 手动序列化</span></span><br><span class="line">    String json = mapper.writeValueAsString(user);</span><br><span class="line">    stringRedisTemplate.opsForValue().set(<span class="string">"name:zwz"</span>,<span class="string">"zwz"</span>);</span><br><span class="line">    </span><br><span class="line">    String value = stringRedisTemplate.opsForValue().get(<span class="string">"name:zwz"</span>);</span><br><span class="line">    mapper.readValue(value,User<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总结：</p>
<ul>
<li><p>方案一：</p>
<ol>
<li><p>自定义RedisTemplate</p>
</li>
<li><p>修改RedisTemplate的序列化器为GenericJackson2JsonRedisSerializer</p>
</li>
</ol>
</li>
<li><p>方案二：</p>
<ol>
<li><p>使用StringRedisTemplate</p>
</li>
<li><p>写入Redis时，手动把对象序列化为JSON</p>
</li>
<li><p>读取Redis时，手动把读取到的JSON反序列化为对象</p>
</li>
</ol>
</li>
</ul>
<h2 id="Redis实战"><a href="#Redis实战" class="headerlink" title="Redis实战"></a>Redis实战</h2><p>项目介绍：该项目主要是用Springboot整合巩固Redis的应用，并具体到项目中，对需求等一系列分析进而实现以下功能；</p>
<blockquote>
<p>前端页面用Nginx代理 </p>
</blockquote>
<p><a href="https://www.helloimg.com/image/Rmto55" target="_blank" rel="noopener"><img src="https://www.helloimg.com/images/2022/04/05/Rmto55.png" alt="Rmto55.png"></a></p>
<h3 id="常量的定义"><a href="#常量的定义" class="headerlink" title="常量的定义"></a>常量的定义</h3><p><a href="https://www.helloimg.com/image/RmtPdm" target="_blank" rel="noopener"><img src="https://www.helloimg.com/images/2022/04/05/RmtPdm.png" alt="RmtPdm.png"></a></p>
<h3 id="part1-短信登录"><a href="#part1-短信登录" class="headerlink" title="part1 短信登录"></a>part1 短信登录</h3><p><a href="https://www.helloimg.com/image/RmtFm0" target="_blank" rel="noopener"><img src="https://www.helloimg.com/images/2022/04/05/RmtFm0.png" alt="RmtFm0.png"></a></p>
<p>按照以上流程图来编写</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">sendCode</span><span class="params">(String phone, HttpSession session)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.校验手机号</span></span><br><span class="line">        <span class="keyword">if</span> (RegexUtils.isPhoneInvalid(phone)) &#123;</span><br><span class="line">            <span class="comment">//2.如果不符合，返回错误信息</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">"手机号格式错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3.符合，生成验证码</span></span><br><span class="line">        String code = RandomUtil.randomNumbers(<span class="number">6</span>);</span><br><span class="line">        <span class="comment">//4.保存验证码到 redis    // set key value ex 120</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(LOGIN_CODE_KEY + phone,code,LOGIN_CODE_TTL, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.发送验证码</span></span><br><span class="line">        log.debug(<span class="string">"发送短信验证码成功，验证码是："</span>+code);</span><br><span class="line">        <span class="comment">//返回ok</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://www.helloimg.com/image/Rm4ZPt" target="_blank" rel="noopener"><img src="https://www.helloimg.com/images/2022/04/05/Rm4ZPt.png" alt="Rm4ZPt.png"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="comment">//loginForm 封装着前台传递来的json信息</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">login</span><span class="params">(LoginFormDTO loginForm, HttpSession session)</span> </span>&#123;	</span><br><span class="line">    <span class="comment">//1.校验手机号</span></span><br><span class="line">    String phone = loginForm.getPhone();</span><br><span class="line">    <span class="keyword">if</span> (RegexUtils.isPhoneInvalid(phone)) &#123;			<span class="comment">//RegexUtils是自己写的校验工具类</span></span><br><span class="line">        <span class="comment">//2.如果不符合，返回错误信息</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">"手机号格式错误"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3. 从redis获取验证码并校验</span></span><br><span class="line">    String cacheCode = stringRedisTemplate.opsForValue().get(LOGIN_CODE_KEY + phone);</span><br><span class="line">    String code = loginForm.getCode();</span><br><span class="line">    <span class="keyword">if</span> (cacheCode == <span class="keyword">null</span> || !cacheCode.equals(code)) &#123;</span><br><span class="line">        <span class="comment">//不一致，直接报错</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">"验证码错误"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.一致，根据手机号查询用户 select * from tb_user where phone = ?</span></span><br><span class="line">    User user = query().eq(<span class="string">"phone"</span>, phone).one();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.判断用户是否存在</span></span><br><span class="line">    <span class="keyword">if</span> (user==<span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//6.不存在，创建新用户</span></span><br><span class="line">        user = createUserWithPhone(phone);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7.存在，保存用户信息到redis</span></span><br><span class="line">    <span class="comment">// 7.1 随机生成token，作为登录令牌</span></span><br><span class="line">    String token = UUID.randomUUID().toString(<span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">// 7.2 将User对象转换为HashMap存储</span></span><br><span class="line">    UserDTO userDTO = BeanUtil.copyProperties(user, UserDTO<span class="class">.<span class="keyword">class</span>)</span>;	<span class="comment">//先把user对象转换为UserDTO对象</span></span><br><span class="line">    <span class="comment">//UserDTO userDTO = new UserDTO();</span></span><br><span class="line">    <span class="comment">//userDTO.setUserId(user.getId());</span></span><br><span class="line">    <span class="comment">//userDTO.setNickName(user.getNickName());</span></span><br><span class="line">    <span class="comment">//  userDTO.setIcon(user.getIcon());</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//通过BeanUtil工具类把userDTO变为map类型</span></span><br><span class="line">    Map&lt;String, Object&gt; userMap = BeanUtil.beanToMap(userDTO,<span class="keyword">new</span> HashMap&lt;&gt;(),</span><br><span class="line">            CopyOptions.create()</span><br><span class="line">                    .setIgnoreNullValue(<span class="keyword">true</span>)</span><br><span class="line">                    .setFieldValueEditor((fieldName,fieldValue) -&gt; fieldValue.toString()));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 7.3 存储</span></span><br><span class="line">    String tokenKey = LOGIN_USER_KEY + token;</span><br><span class="line">    stringRedisTemplate.opsForHash().putAll(tokenKey,userMap);</span><br><span class="line">    <span class="comment">//7.4设置token有效期</span></span><br><span class="line">    stringRedisTemplate.expire(tokenKey,LOGIN_USER_TTL,TimeUnit.MINUTES);</span><br><span class="line">    <span class="comment">// 8.返回token</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(token);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>用户不存在则创建用户</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> User <span class="title">createUserWithPhone</span><span class="params">(String phone)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.创建用户</span></span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setPhone(phone);</span><br><span class="line">        user.setNickName(USER_NICK_NAME_PREFIX + RandomUtil.randomString(<span class="number">10</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.保存用户</span></span><br><span class="line">        save(user);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="part2-添加Redis缓存"><a href="#part2-添加Redis缓存" class="headerlink" title="part2 添加Redis缓存"></a>part2 添加Redis缓存</h3><p>当我们没有添加Redis缓存的时候，我们每次查询操作都直接对数据库进行操作，因此数据库的压力会很大，如果我们加了Redis缓存之后，每次查询的时候都先查询Redis里面是否有数据，有则直接拿出来，否则再查找数据库并存入Redis中。</p>
<p><a href="https://www.helloimg.com/image/RmAJJo" target="_blank" rel="noopener"><img src="https://www.helloimg.com/images/2022/04/05/RmAJJo.png" alt="RmAJJo.png"></a></p>
<p><strong>根据ID查询商铺缓存的流程</strong></p>
<p><a href="https://www.helloimg.com/image/RmAxub" target="_blank" rel="noopener"><img src="https://www.helloimg.com/images/2022/04/05/RmAxub.png" alt="RmAxub.png"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">queryById</span><span class="params">(Long id)</span></span>&#123;</span><br><span class="line">    String key = <span class="string">"CACHE_SHOP_KEY"</span> + id;</span><br><span class="line">    <span class="comment">//查询redis中是否有缓存</span></span><br><span class="line">    String shopJson  = stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="comment">//判断</span></span><br><span class="line">    <span class="keyword">if</span>(shopJson.isBlank(shopJson))&#123;</span><br><span class="line">        <span class="comment">//没有则查询数据库</span></span><br><span class="line">        Shop shop = getById(id);  (mybatis-plus的API)</span><br><span class="line">        <span class="keyword">if</span>(shop == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail();</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//把获取到的shop序列化为json然后存储到redis中</span></span><br><span class="line">        stringRedisTemplate.opsForValue()</span><br><span class="line">        	.set(key,JSONUtil.toJsonStr(shop),<span class="string">"CACHE_NULL_TTL"</span>,TimeUnit.MINUTES);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(shop);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//有则先把json数据反序列化为对象</span></span><br><span class="line">    Shop shop = JSONUtil.toBean(shopJson,Shop<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">	<span class="title">return</span> <span class="title">Result</span>.<span class="title">ok</span>(<span class="title">shop</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="part3-给店铺类型查询业务添加缓存"><a href="#part3-给店铺类型查询业务添加缓存" class="headerlink" title="part3 给店铺类型查询业务添加缓存"></a>part3 给店铺类型查询业务添加缓存</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">   <span class="meta">@Resource</span></span><br><span class="line">   <span class="keyword">private</span> IShopTypeService typeService;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Result <span class="title">queryBySort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       String key = CACHE_SHOP_TYPE_KEY;</span><br><span class="line">       <span class="comment">//1.通过redis 查询缓存是否存在shopType</span></span><br><span class="line">       String shopType = stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">       <span class="comment">//2.存在则返回</span></span><br><span class="line">       <span class="keyword">if</span> (StrUtil.isNotBlank(shopType)) &#123;</span><br><span class="line">           List&lt;ShopType&gt; shopTypeList = JSONUtil.toList(shopType, ShopType<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">           <span class="keyword">return</span> Result.ok(shopTypeList);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//3.不存在则查询数据库</span></span><br><span class="line">       List&lt;ShopType&gt; sort = typeService.query().orderByAsc(<span class="string">"sort"</span>).list();</span><br><span class="line">       <span class="comment">//4.查询数据库并保存到redis中</span></span><br><span class="line">       <span class="keyword">if</span> (sort.size()==<span class="number">0</span>)&#123;</span><br><span class="line">           <span class="keyword">return</span> Result.fail(<span class="string">"不存在商品类型"</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       stringRedisTemplate.opsForValue().set(key,JSONUtil.toJsonStr(sort));</span><br><span class="line">       <span class="keyword">return</span> Result.ok(sort);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h3 id="part4-缓冲更新策略"><a href="#part4-缓冲更新策略" class="headerlink" title="part4 缓冲更新策略"></a>part4 缓冲更新策略</h3><p><a href="https://www.helloimg.com/image/RmvOhS" target="_blank" rel="noopener"><img src="https://www.helloimg.com/images/2022/04/05/RmvOhS.png" alt="RmvOhS.png"></a></p>
<p><a href="https://www.helloimg.com/image/RmvvWQ" target="_blank" rel="noopener"><img src="https://www.helloimg.com/images/2022/04/05/RmvvWQ.png" alt="RmvvWQ.png"></a></p>
<blockquote>
<p>Cache Aside Pattern CAP模式的意思是，对数据POST/PUT的时候，更新数据库之后直接把旧的缓存删除掉，不再做任何操作。在GET数据的时候，发现没有数据，就从数据库拿，再更新到缓存。我们会发现，会有极端情况导致GET得到了缓存的数据和实际库的数据不一样的情况</p>
</blockquote>
<blockquote>
<p>Read/Write Through Pattern 中服务端把 cache 视为主要数据存储，从中读取数据并将数据写入其中。cache 服务负责将此数据读取和写入 DB，从而减轻了应用程序的职责。</p>
<p>这种缓存读写策略小伙伴们应该也发现了在平时在开发过程中非常少见。抛去性能方面的影响，大概率是因为我们经常使用的<a href="https://so.csdn.net/so/search?q=分布式&spm=1001.2101.3001.7020" target="_blank" rel="noopener">分布式</a>缓存 Redis 并没有提供 cache 将数据写入DB的功能。</p>
</blockquote>
<blockquote>
<p>Write Behind Caching Pattern 这种模式类似于Linux中的page cache原理，即数据更新时紧紧更新缓存，不更新数据库，后期由缓存异步的、批量的更新数据库，这种模式会极大的提高数据写入速度没因为直接在内存层面操作。但也会带来一些列不足，比如无法保证数据的强一致性，系统非正常关机的情况下可能会导致数据丢失。</p>
</blockquote>
<p><a href="https://www.helloimg.com/image/RmvQHv" target="_blank" rel="noopener"><img src="https://www.helloimg.com/images/2022/04/05/RmvQHv.png" alt="RmvQHv.png"></a></p>
<p>于是乎我们使用CAP 模式，但是应该先操作缓存还是操作数据库呢？ 看以下案例</p>
<p><img src="https://www.helloimg.com/images/2022/04/05/Rmv7CY.png" alt="Rmv7CY.png"></p>
<blockquote>
<p>这里是先操作缓存。如果先删除缓存，那么当删除缓存操作结束后时间片用完到另一个线程，一定会去查询数据库并写入缓存。</p>
</blockquote>
<p><img src="https://www.helloimg.com/images/2022/04/05/RmvpDE.png" alt="RmvpDE.png"></p>
<blockquote>
<p>这里是先操作数据库。</p>
</blockquote>
<p>我们会优先选择方案二：即先操作数据库。因为这种情况的概率比第一种低</p>
<p>出现该种情况要符合三个条件：</p>
<ul>
<li>有两个并行的线程</li>
<li>有一个线程来查缓存正好缓存失效了</li>
<li>在写缓存的时候突然来了个线程，刚好时间片用完先执行线程2，刚好线程2是更新数据库的。</li>
</ul>
<p>综上看，情况2的概率非常非常低</p>
<h3 id="part5-缓存穿透"><a href="#part5-缓存穿透" class="headerlink" title="part5 缓存穿透"></a>part5 缓存穿透</h3><p><a href="https://www.helloimg.com/image/Rmvran" target="_blank" rel="noopener"><img src="https://www.helloimg.com/images/2022/04/05/Rmvran.png" alt="Rmvran.png"></a></p>
<p>于是原来的程序流程图应该变成这样</p>
<p><a href="https://www.helloimg.com/image/RmvhGA" target="_blank" rel="noopener"><img src="https://www.helloimg.com/images/2022/04/05/RmvhGA.png" alt="RmvhGA.png"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 缓存穿透</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Shop <span class="title">queryWithPassThrough</span><span class="params">(Long id)</span></span>&#123;</span><br><span class="line">    String key = CACHE_SHOP_KEY+id;</span><br><span class="line">    <span class="comment">//1.从Redis查询商铺缓存</span></span><br><span class="line">    String shopJson = stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="comment">//2.判断是否存在</span></span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isNotBlank(shopJson)) &#123;</span><br><span class="line">        <span class="comment">//3.存在，直接返回</span></span><br><span class="line">        Shop shop = JSONUtil.toBean(shopJson, Shop<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="keyword">return</span> shop;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//命中的是否是空值</span></span><br><span class="line">    <span class="comment">//这里判断是不是"" 空值，因为按照流程来说，如果不存在缓存会去查询数据库，但是如果缓存是""值那么就要返回null，根据以上流程。查询到数据了那么要么是商铺信息要么是空串，所以要加这一句。</span></span><br><span class="line">    <span class="keyword">if</span> (shopJson != <span class="keyword">null</span>)&#123;		</span><br><span class="line">        <span class="comment">//返回一个错误信息</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.不存在，根据id查询数据库</span></span><br><span class="line">    Shop shop = getById(id);</span><br><span class="line">    <span class="comment">//5.不存在，返回错误</span></span><br><span class="line">    <span class="keyword">if</span> (shop == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">//将空值写入redis</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(key,<span class="string">""</span>,CACHE_NULL_TTL, TimeUnit.MINUTES);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.存在，先写入Redis里面</span></span><br><span class="line">    stringRedisTemplate.opsForValue().set(key,JSONUtil.toJsonStr(shop),CACHE_SHOP_TTL, TimeUnit.MINUTES);</span><br><span class="line">    <span class="comment">//7.返回</span></span><br><span class="line">    <span class="keyword">return</span> shop;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>缓存穿透产生的原因是什么？</p>
<ul>
<li>用户请求的数据在缓存中和数据库中都不存在，不断发起这样的请求，给数据库带来巨大压力</li>
</ul>
<p>缓存穿透的解决方案有哪些？</p>
<ul>
<li><p>缓存null值</p>
</li>
<li><p>布隆过滤</p>
</li>
<li><p>增强id的复杂度，避免被猜测id规律</p>
</li>
<li><p>做好数据的基础格式校验</p>
</li>
<li><p>加强用户权限校验</p>
</li>
<li><p>做好热点参数的限流</p>
<h3 id="part6-缓存雪崩"><a href="#part6-缓存雪崩" class="headerlink" title="part6 缓存雪崩"></a>part6 缓存雪崩</h3></li>
</ul>
<p><a href="https://www.helloimg.com/image/Rmz90E" target="_blank" rel="noopener"><img src="https://www.helloimg.com/images/2022/04/05/Rmz90E.png" alt="Rmz90E.png"></a></p>
<blockquote>
<p>此处一般是设置Redis集群，防止Redis宕机</p>
</blockquote>
<h3 id="part7-缓存击穿"><a href="#part7-缓存击穿" class="headerlink" title="part7 缓存击穿"></a>part7 缓存击穿</h3><p><a href="https://www.helloimg.com/image/RmDA2D" target="_blank" rel="noopener"><img src="https://www.helloimg.com/images/2022/04/05/RmDA2D.png" alt="RmDA2D.png"></a></p>
<p><a href="https://www.helloimg.com/image/RmDLKS" target="_blank" rel="noopener"><img src="https://www.helloimg.com/images/2022/04/05/RmDLKS.png" alt="RmDLKS.png"></a></p>
<blockquote>
<p>互斥锁：为方法加上互斥锁，当需要查询数据库的时候先获取锁对象。</p>
<p>优点：</p>
<pre><code>- 没用额外的内存消耗
- 保证一致性
- 实现简单</code></pre><p>缺点：</p>
<pre><code>- 线程需要等待，性能略差
- 可能会出现死锁问题</code></pre></blockquote>
<blockquote>
<p>逻辑过期：给予缓存一个过期时间，当逻辑过期时(虽然过期了但是Redis 中还是有该缓存) 获取互斥锁，然后开一个新的线程查询数据库并更新缓存。重置逻辑过期的时间。最后新线程释放锁。  而旧线程则返回过期了的数据。 倘若有线程2、3、4….等同时进来的时候需要同时获取锁，失败则返回旧的缓存数据</p>
</blockquote>
<p><a href="https://www.helloimg.com/image/RmIr1X" target="_blank" rel="noopener"><img src="https://www.helloimg.com/images/2022/04/05/RmIr1X.png" alt="RmIr1X.png"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 尝试锁 使用setnx的方法实现互斥锁，因为setnx只能拥有一个 当有人获取锁的时候判断是否具有</span></span><br><span class="line"><span class="comment">* 名为key的键。如果没有则录入，且返回值是1。有的话则不会覆盖，返回值是0。所以只要判断是0还</span></span><br><span class="line"><span class="comment">* 是1就知道是否获取到锁了</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">	Boolean flag = stringRedisTemplate.opsForValue()</span><br><span class="line">			.setIfAbsent(key, <span class="string">"1"</span>, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line">	<span class="keyword">return</span> BooleanUtil.isTrue(flag);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 释放锁 删掉哪个键为key的值即可</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">    stringRedisTemplate.delete(key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 互斥锁</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Shop <span class="title">queryWithMutex</span><span class="params">(Long id)</span></span>&#123;</span><br><span class="line">    String key = CACHE_SHOP_KEY+id;</span><br><span class="line">    <span class="comment">//1.从Redis查询商铺缓存</span></span><br><span class="line">    String shopJson = stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="comment">//2.判断是否存在</span></span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isNotBlank(shopJson)) &#123;</span><br><span class="line">        <span class="comment">//3.存在，直接返回</span></span><br><span class="line">        Shop shop = JSONUtil.toBean(shopJson, Shop<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="keyword">return</span> shop;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//命中的是否是空值</span></span><br><span class="line">    <span class="keyword">if</span> (shopJson != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">//返回一个错误信息</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.开始实现缓存重建</span></span><br><span class="line">    <span class="comment">//4.1 获取互斥锁</span></span><br><span class="line">    String lockKey = <span class="string">"lock:shop:"</span>+id;</span><br><span class="line">    Shop shop = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">boolean</span> getLock = tryLock(lockKey);</span><br><span class="line">        <span class="comment">//4.2 判断是否获取成功</span></span><br><span class="line">        <span class="keyword">if</span> (!getLock) &#123;</span><br><span class="line">            <span class="comment">//4.3 失败，则休眠并重试</span></span><br><span class="line">            Thread.sleep(<span class="number">50</span>);</span><br><span class="line">            <span class="keyword">return</span> queryWithMutex(id);	<span class="comment">//通过递归的方式不断获取锁</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//4.4成功，根据id查询数据库</span></span><br><span class="line">        shop = getById(id);</span><br><span class="line">        <span class="comment">//模拟重建的延时</span></span><br><span class="line">        Thread.sleep(<span class="number">200</span>);</span><br><span class="line">        <span class="comment">//5.不存在，返回错误</span></span><br><span class="line">        <span class="keyword">if</span> (shop == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//将空值写入redis</span></span><br><span class="line">            stringRedisTemplate.opsForValue()</span><br><span class="line">                .set(key,<span class="string">""</span>,CACHE_NULL_TTL, TimeUnit.MINUTES);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//6.存在，先写入Redis里面</span></span><br><span class="line">        stringRedisTemplate.opsForValue()</span><br><span class="line">            .set(key,JSONUtil.toJsonStr(shop),CACHE_SHOP_TTL, TimeUnit.MINUTES);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">//7.1释放互斥锁</span></span><br><span class="line">        unlock(lockKey);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//8.返回</span></span><br><span class="line">    <span class="keyword">return</span> shop;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<p><a href="https://www.helloimg.com/image/Rm6XuT" target="_blank" rel="noopener"><img src="https://www.helloimg.com/images/2022/04/05/Rm6XuT.png" alt="Rm6XuT.png"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 封装逻辑过期</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveShop2Redis</span><span class="params">(Long id,Long expireSeconds)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="comment">//1.查询店铺数据</span></span><br><span class="line">    Shop shop = getById(id);</span><br><span class="line">    <span class="comment">//Thread.sleep(200);</span></span><br><span class="line">    <span class="comment">//2.封装逻辑过期</span></span><br><span class="line">    RedisData redisData = <span class="keyword">new</span> RedisData();	<span class="comment">//该类中定义了Object data 以及LocalDateTime time</span></span><br><span class="line">    redisData.setData(shop);</span><br><span class="line">    redisData.setExpireTime(LocalDateTime.now().plusSeconds(expireSeconds));</span><br><span class="line">    <span class="comment">//3.写入Redis</span></span><br><span class="line">    stringRedisTemplate.opsForValue()</span><br><span class="line">        .set(CACHE_SHOP_KEY+id,JSONUtil.toJsonStr(redisData));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 逻辑过期解决缓存击穿</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Shop <span class="title">queryWithLogicalExpire</span><span class="params">(Long id)</span></span>&#123;</span><br><span class="line">    String key = CACHE_SHOP_KEY+id;</span><br><span class="line">    <span class="comment">//1.从Redis查询商铺缓存</span></span><br><span class="line">    String shopJson = stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="comment">//2.判断是否存在</span></span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isBlank(shopJson)) &#123;</span><br><span class="line">        <span class="comment">//3.不存在，直接返回</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4.命中，判断过期时间，先把json反序列化为对象</span></span><br><span class="line">    RedisData redisData = JSONUtil.toBean(shopJson, RedisData<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    JSONObject data = (JSONObject) redisData.getData();     <span class="comment">//因为上面通过工具类转换为bean中，RedisData里面的data是Object类型，所以实际上转化的Bean类型是JSONObject类型</span></span><br><span class="line">    Shop shop = JSONUtil.toBean(data, Shop<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    LocalDateTime expireTime = redisData.getExpireTime();</span><br><span class="line">    <span class="comment">//5.判断是否过期</span></span><br><span class="line">    <span class="keyword">if</span> (expireTime.isAfter(LocalDateTime.now()))&#123;</span><br><span class="line">        <span class="comment">//5.1.未过期，直接返回店铺信息</span></span><br><span class="line">        <span class="keyword">return</span> shop;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5.2.已过期，需要缓存重建</span></span><br><span class="line">    <span class="comment">//6.缓存重建</span></span><br><span class="line">    <span class="comment">//6.1.获取互斥锁</span></span><br><span class="line">    String lockKey = CACHE_LOCK_KEY  + id;</span><br><span class="line">    <span class="keyword">boolean</span> isGet = tryLock(lockKey);</span><br><span class="line">    <span class="comment">//6.2.判断是否获取锁成功</span></span><br><span class="line">    <span class="keyword">if</span> (isGet)&#123;</span><br><span class="line">        <span class="comment">//6.3.成功，开启独立线程，实现缓存重建</span></span><br><span class="line">        CACHE_REBUILD_EXECUTOR.submit(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//重建缓存</span></span><br><span class="line">                <span class="keyword">this</span>.saveShop2Redis(id,<span class="number">20L</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">//释放锁</span></span><br><span class="line">                unlock(lockKey);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.4.失败，返回过期的商品信息</span></span><br><span class="line">    <span class="keyword">return</span> shop;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="part8-缓存工具封装"><a href="#part8-缓存工具封装" class="headerlink" title="part8 缓存工具封装"></a>part8 缓存工具封装</h3><p><a href="https://www.helloimg.com/image/Rm6j8D" target="_blank" rel="noopener"><img src="https://www.helloimg.com/images/2022/04/05/Rm6j8D.png" alt="Rm6j8D.png"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 详细看黑马Redis  P35 - P46</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CacheClient</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(String key, Object value, Long time, TimeUnit unit)</span></span>&#123;</span><br><span class="line">        String JsonValue = JSONUtil.toJsonStr(value);</span><br><span class="line">        stringRedisTemplate.opsForValue().set(key,JsonValue,time,unit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 逻辑过期封装方法</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWithLogicalExpire</span><span class="params">(String key, Object value, Long time, TimeUnit unit)</span></span>&#123;</span><br><span class="line">        <span class="comment">//设置逻辑过期</span></span><br><span class="line">        RedisData redisData = <span class="keyword">new</span> RedisData();</span><br><span class="line">        redisData.setData(value);</span><br><span class="line">        redisData.setExpireTime(LocalDateTime.now().plusSeconds(unit.toSeconds(time)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//写入Redis</span></span><br><span class="line">        String JsonValue = JSONUtil.toJsonStr(redisData);</span><br><span class="line">        stringRedisTemplate.opsForValue().set(key,JsonValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 缓存穿透</span></span><br><span class="line"><span class="comment">     * 因为这是一个工具类所以返回值不能写死，不知道类型如何就用泛型，因为使用泛型所以形参中要获取类型的类。所以Class&lt;R&gt; type</span></span><br><span class="line"><span class="comment">     * id 用于查询数据库</span></span><br><span class="line"><span class="comment">     * keyPrefix 用于查询Redis</span></span><br><span class="line"><span class="comment">     * dbFallback 由于不用需求查询数据库不一样，所以我们无法确定如何实现，因此需要用户传递参数给该方法，又因为查询数据库是根据id查的 所以 是一个有参有返回值的函数，</span></span><br><span class="line"><span class="comment">     * 需要用到有参有返回值的响应式函数 Function&lt;ID,R&gt; ID泛型代表形参传入的类型  R代表返回的类型！</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;R,ID&gt; <span class="function">R <span class="title">queryWithPassThrough</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            String keyPrefix , ID id , Class&lt;R&gt; type , Function&lt;ID,R&gt; dbFallback ,Long time ,TimeUnit unit)</span></span>&#123;</span><br><span class="line">        String key = keyPrefix + id;</span><br><span class="line">        <span class="comment">//1.从Redis查询商铺缓存</span></span><br><span class="line">        String json = stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="comment">//2.判断是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isNotBlank(json)) &#123;</span><br><span class="line">            <span class="comment">//3.存在，直接返回</span></span><br><span class="line">            <span class="keyword">return</span> (R) JSONUtil.toBean(json, type);         <span class="comment">//返回不知道上面类型但是上面传进来的Class&lt;R&gt;因此把 tpye传进去</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//命中的是否是空值</span></span><br><span class="line">        <span class="keyword">if</span> (json != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//返回一个错误信息</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.不存在，根据id查询数据库  此处使用了响应式函数编程</span></span><br><span class="line">        R r = dbFallback.apply(id);</span><br><span class="line">        <span class="comment">//5.不存在，返回错误</span></span><br><span class="line">        <span class="keyword">if</span> (r == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//将空值写入redis</span></span><br><span class="line">            stringRedisTemplate.opsForValue().set(key,<span class="string">""</span>,CACHE_NULL_TTL, TimeUnit.MINUTES);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//6.存在，先写入Redis里面</span></span><br><span class="line">        <span class="keyword">this</span>.set(key,r,time,unit);</span><br><span class="line">        <span class="comment">//7.返回</span></span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//线程池</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ExecutorService CACHE_REBUILD_EXECUTOR = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 尝试锁</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">        Boolean flag = stringRedisTemplate.opsForValue().setIfAbsent(key, <span class="string">"1"</span>, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">return</span> BooleanUtil.isTrue(flag);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 释放锁</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">        stringRedisTemplate.delete(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 逻辑过期解决缓存击穿</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;R,ID&gt; <span class="function">R <span class="title">queryWithLogicalExpire</span><span class="params">(String keyPrefix,ID id,Class&lt;R&gt; type,Function&lt;ID,R&gt; dbFallback,Long time ,TimeUnit unit)</span></span>&#123;</span><br><span class="line">        String key = keyPrefix+id;</span><br><span class="line">        <span class="comment">//1.从Redis查询商铺缓存</span></span><br><span class="line">        String json = stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="comment">//2.判断是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(json)) &#123;</span><br><span class="line">            <span class="comment">//3.不存在，直接返回</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//4.命中，判断过期时间，先把json反序列化为对象</span></span><br><span class="line">        RedisData redisData = JSONUtil.toBean(json, RedisData<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        JSONObject data = (JSONObject) redisData.getData();     <span class="comment">//因为上面通过工具类转换为bean中，RedisData里面的data是Object类型，所以实际上转化的Bean类型是JSONObject类型</span></span><br><span class="line">        R r = JSONUtil.toBean(data, type);</span><br><span class="line"></span><br><span class="line">        LocalDateTime expireTime = redisData.getExpireTime();</span><br><span class="line">        <span class="comment">//5.判断是否过期</span></span><br><span class="line">        <span class="keyword">if</span> (expireTime.isAfter(LocalDateTime.now()))&#123;</span><br><span class="line">            <span class="comment">//5.1.未过期，直接返回店铺信息</span></span><br><span class="line">            <span class="keyword">return</span> r;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//5.2.已过期，需要缓存重建</span></span><br><span class="line">        <span class="comment">//6.缓存重建</span></span><br><span class="line">        <span class="comment">//6.1.获取互斥锁</span></span><br><span class="line">        String lockKey = CACHE_LOCK_KEY  + id;</span><br><span class="line">        <span class="keyword">boolean</span> isGet = tryLock(lockKey);</span><br><span class="line">        <span class="comment">//6.2.判断是否获取锁成功</span></span><br><span class="line">        <span class="keyword">if</span> (isGet)&#123;</span><br><span class="line">            <span class="comment">//6.3.成功，开启独立线程，实现缓存重建</span></span><br><span class="line">            CACHE_REBUILD_EXECUTOR.submit(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">//重建缓存</span></span><br><span class="line">                    <span class="comment">//1.先查数据库</span></span><br><span class="line">                    R r1 = dbFallback.apply(id);</span><br><span class="line">                    <span class="comment">//2.再写入Redis</span></span><br><span class="line">                    <span class="keyword">this</span>.setWithLogicalExpire(key,r1,time,unit);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">                &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="comment">//释放锁</span></span><br><span class="line">                    unlock(lockKey);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//6.4.失败，返回过期的商品信息</span></span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="part9"><a href="#part9" class="headerlink" title="part9"></a>part9</h3>
    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/02/21/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/" rel="prev" title="垃圾回收">
      <i class="fa fa-chevron-left"></i> 垃圾回收
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/03/31/CRC%20%E5%BE%AA%E7%8E%AF%E5%86%97%E4%BD%99%E6%A0%A1%E9%AA%8C/" rel="next" title="CRC 循环冗余校验">
      CRC 循环冗余校验 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis"><span class="nav-number">1.</span> <span class="nav-text">Redis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是Redis"><span class="nav-number">1.1.</span> <span class="nav-text">什么是Redis</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis数据结构介绍"><span class="nav-number">1.2.</span> <span class="nav-text">Redis数据结构介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-通用命令"><span class="nav-number">1.3.</span> <span class="nav-text">Redis 通用命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#String-类型"><span class="nav-number">1.3.1.</span> <span class="nav-text">String 类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hash类型"><span class="nav-number">1.3.2.</span> <span class="nav-text">Hash类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#List类型"><span class="nav-number">1.3.3.</span> <span class="nav-text">List类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Set类型"><span class="nav-number">1.3.4.</span> <span class="nav-text">Set类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SortedSet类型"><span class="nav-number">1.3.5.</span> <span class="nav-text">SortedSet类型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-的java客户端"><span class="nav-number">1.4.</span> <span class="nav-text">Redis 的java客户端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SpringDataRedis"><span class="nav-number">1.4.1.</span> <span class="nav-text">SpringDataRedis</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SpringDataRedis-快速入门"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">SpringDataRedis 快速入门</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Redis序列化"><span class="nav-number">1.4.1.1.1.</span> <span class="nav-text">Redis序列化</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis实战"><span class="nav-number">1.5.</span> <span class="nav-text">Redis实战</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#常量的定义"><span class="nav-number">1.5.1.</span> <span class="nav-text">常量的定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#part1-短信登录"><span class="nav-number">1.5.2.</span> <span class="nav-text">part1 短信登录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#part2-添加Redis缓存"><span class="nav-number">1.5.3.</span> <span class="nav-text">part2 添加Redis缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#part3-给店铺类型查询业务添加缓存"><span class="nav-number">1.5.4.</span> <span class="nav-text">part3 给店铺类型查询业务添加缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#part4-缓冲更新策略"><span class="nav-number">1.5.5.</span> <span class="nav-text">part4 缓冲更新策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#part5-缓存穿透"><span class="nav-number">1.5.6.</span> <span class="nav-text">part5 缓存穿透</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#part6-缓存雪崩"><span class="nav-number">1.5.7.</span> <span class="nav-text">part6 缓存雪崩</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#part7-缓存击穿"><span class="nav-number">1.5.8.</span> <span class="nav-text">part7 缓存击穿</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#part8-缓存工具封装"><span class="nav-number">1.5.9.</span> <span class="nav-text">part8 缓存工具封装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#part9"><span class="nav-number">1.5.10.</span> <span class="nav-text">part9</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ZWZ</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">42</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZWZ</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.7.1
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
